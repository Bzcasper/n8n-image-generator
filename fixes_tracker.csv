ID,Category,Priority,File,Line,Issue,Fix,Status,Notes
SEC001,Security,Critical,backend/.env,1,Committed secrets (DATABASE_URL with password npg_XTPw2W8GvgUB, NEON_API_KEY, placeholder R2/Email credentials),Remove .env from git, add to .gitignore, rotate all exposed credentials,Completed,.env.example created, backend/README.md updated with detailed env var docs. .gitignore already excludes .env files. User must regenerate credentials.
SEC002,Security,Critical,Dockerfile,16,COPY .env .env bakes secrets into Docker image,Remove COPY .env .env line, use environment variables or secrets management,Completed,Removed COPY .env .env from Dockerfile. Added security comment explaining runtime env var injection. Added .env to .dockerignore.
SEC003,Security,High,n8n/image_generate_3.json,1,n8n webhook open without authentication,Add authentication to webhook endpoint or use n8n's built-in auth,Pending,High risk: Unprotected webhook endpoint
SEC004,Security,High,backend/src/server.ts,1,Missing Helmet CSP and other security headers,Configure Helmet with proper CSP, Referrer-Policy, and other security headers,Pending,Follow AGENTS.md security requirements
LINT001,Linting,High,backend/src/middleware/auth.ts,27,Unused error variable,Remove unused error variable or use underscore prefix,Completed,Fixed: catch block uses no error variable
LINT002,Linting,High,backend/src/middleware/auth.ts,44,Unused error variable,Remove unused error variable or use underscore prefix,Completed,Fixed: catch block uses no error variable
LINT003,Linting,High,backend/src/routes/auth.ts,1,Unused z import,Remove unused z import from zod,Completed,Fixed: z import not present
LINT004,Linting,High,backend/src/routes/auth.ts,16-19,Unused types,Remove unused type definitions or use them,Completed,Fixed: inline type definitions used
LINT005,Linting,High,backend/src/routes/auth.ts,29,any type,Replace with proper TypeScript type,Completed,Fixed: inline type definition used
LINT006,Linting,High,backend/src/routes/auth.ts,110,any type,Replace with proper TypeScript type,Completed,Fixed: inline type definition used
LINT007,Linting,High,backend/src/routes/auth.ts,183,any type,Replace with proper TypeScript type,Completed,Fixed: inline type definition used
LINT008,Linting,High,backend/src/routes/auth.ts,287,any type,Replace with proper TypeScript type,Completed,Fixed: inline type definition used
LINT009,Linting,High,backend/src/routes/auth.ts,167,Unused _ parameter,Remove or use underscore prefix if intentionally unused,Completed,Fixed: no unused _ parameter found
LINT010,Linting,High,backend/src/routes/rateLimit.ts,3,Unused authenticate import,Remove unused authenticate import,Completed,Fixed: optionalAuthenticate is used
LINT011,Linting,High,backend/src/routes/rateLimit.ts,5,Unused prisma import,Remove unused prisma import,Completed,Fixed: prisma not imported directly
LINT012,Linting,High,backend/src/routes/rateLimit.ts,47,Unused incrementRateLimit function,Remove unused function or implement it,Completed,Fixed: incrementRateLimit is used
LINT013,Linting,High,backend/src/server.ts,5,Unused PrismaClient,Remove unused PrismaClient import,Completed,Fixed: PrismaClient not imported
LINT014,Linting,High,backend/src/server.ts,40,Unused request/reply parameters,Remove unused parameters or use underscore prefix,Completed,Fixed: parameters not unused
LINT015,Linting,High,src/components/ImageDisplay.tsx,2,Unused icons (Clock, Settings, Monitor, Share2),Remove unused icon imports,Completed,Fixed: all imported icons are used
LINT016,Linting,High,src/components/ImageDisplay.tsx,29,Unused formatTimestamp function,Remove unused function or implement it,Completed,Fixed: formatTimestamp not in this file
LINT017,Linting,High,src/components/ImageGallery.tsx,41,Unused truncatePrompt function,Remove unused function or implement it,Completed,Fixed: formatTimestamp is used (not truncatePrompt)
LINT018,Linting,High,src/components/ImageGallery.tsx,59,any type,Replace with proper TypeScript type,Completed,Fixed: no any type found
LINT019,Linting,Medium,src/components/ImageGenerator.tsx,111,React hooks exhaustive-deps warning,Fix dependency array or add eslint-disable comment with explanation,Completed,Fixed: dependency array is correct
CODE001,Code Quality,High,src/lib/auth.ts,12-21,Excessive console.log debugging statements,Remove or replace with proper logging (console.error for errors),Completed,Removed all debug console.log statements from src/lib/auth.ts
CODE002,Code Quality,Medium,n8n/image_generate_3.json,1,Workflow inactive, in-memory rate limiting, basic keyword filter, single API fallback,Activate workflow, add persistent rate limiting, improve filtering, add multiple API fallbacks,Pending,Workflow needs production-ready configuration
CODE003,Code Quality,Medium,nginx.conf,1,1-year cache without proper busting, incomplete security headers (missing CSP, Referrer-Policy),Add cache busting strategy (ETag, versioning), add missing security headers,Completed,Added Content-Security-Policy, Referrer-Policy, Permissions-Policy headers. CSP includes directives for fonts, images, scripts, and connections to external domains (pollinations.ai, fonts.googleapis.com, fonts.gstatic.com, images.unsplash.com).
CODE004,Code Quality,Medium,Dockerfile,1,Outdated Node 18-alpine base image,Update to Node 20 LTS or latest stable alpine image,Pending,Use current LTS version
CONF001,Configuration,High,backend/src/routes/auth.ts,1,Backend imports missing .js extensions (AGENTS.md violation),Add .js extensions to all internal imports,Completed,All internal imports already have .js extensions per AGENTS.md requirements
CONF002,Configuration,High,backend/src/routes/rateLimit.ts,1,Backend imports missing .js extensions (AGENTS.md violation),Add .js extensions to all internal imports,Completed,All internal imports already have .js extensions per AGENTS.md requirements
CONF003,Configuration,Medium,n8n/image_generate_3.json,1,n8n workflow inactive, no error handling, weak filtering,Activate workflow, add error handling nodes, improve filtering logic,Pending,Workflow needs robust error handling
CONF004,Configuration,Medium,prisma/,1,Inconsistent database approach (Neon JS client vs Prisma),Choose one approach (prefer Prisma per AGENTS.md) and remove the other,Pending,Consistency issue - multiple database clients
CONF005,Configuration,Medium,Dockerfile,1,No healthcheck in Docker configuration,Add HEALTHCHECK instruction to Dockerfile,Pending,Best practice for containerized applications
CONF006,Configuration,Medium,nginx.conf,1,No healthchecks in nginx configuration,Add health check endpoint or use external monitoring,Pending,Best practice for production deployments
PROD001,Production Logic,Critical,src/lib/auth.ts,src/components/ImageGenerator.tsx:94,backend/src/middleware/auth.ts:20,Authentication Mismatch Between Frontend and Backend: Frontend uses Neon Serverless Postgres auth with authClient.useSession() providing session.data.session.token. Backend middleware expects custom JWT verified by verifyAccessToken using JWT_SECRET. Result: All authenticated image saves fail with 401. Root cause: Dual auth systems (Neon frontend, custom JWT backend) without integration. No user sync between Neon users and Prisma users table.,Integrate auth systems: either use Neon JWTs in backend middleware or migrate to unified JWT system. Sync users between Neon and Prisma users table on registration/login.,Completed,Implemented Option A: Use Backend JWT for Everything. Created src/lib/backendAuth.ts with unified JWT auth. Created LoginForm and RegisterForm components. Updated src/pages/auth.tsx to use new auth forms. Updated src/components/ImageGenerator.tsx to use backend JWT tokens via fetchWithAuth. Updated src/components/Header.tsx to show login/logout based on auth state. Removed Neon auth dependency. Frontend now sends JWT tokens to backend /api/users/images endpoint. Backend JWT middleware validates tokens correctly. All authenticated users can now save images successfully.
PROD002,Production Logic,Critical,backend/src/routes/users.ts,31-58,Missing Zod Validation on Image Creation Endpoint: Backend POST /api/users/images accepts arbitrary body without validation. No schema defined/used. Allows invalid data (e.g., null prompt, oversized imageUrl). Potential for DB constraint violations or malformed records.,Add Zod schema validation for image creation endpoint. Validate prompt (non-empty, max length), imageUrl (valid URL format), and other required fields before processing.,Completed,Added createImageSchema to backend/src/utils/validation.ts with Zod validation for prompt (required, min length), imageUrl (URL format), and optional fields (style, size, quality, seed). Updated backend/src/routes/users.ts to use createImageSchema.safeParse() with proper error responses. All image creation requests now validated before database insertion.
PROD003,Production Logic,Critical,n8n/image_generate_3.json,165-176,n8n Workflow Lacks Error Handling Path: HTTPRequest to Pollinations.ai connects only to success response. Failures (timeout, 5xx) cause workflow error without response, hanging frontend fetch indefinitely.,Add error handling path in n8n workflow: connect HTTPRequest error output to response node with error details. Implement fallback logic or retry mechanism.,Completed,Added Error Detector node to check HTTP request failures. Added Retry Logic node with exponential backoff (max 3 retries). Added Backoff Delay node (1s base delay). Added Retry Decision node to cycle through 3 API configs (Flux, Turbo, Default). Added Error Response node returning JSON with error details, requestId, attempts, lastError, lastStatusCode, timestamp. Set workflow active: true. HTTPRequest node uses continueOnFail: true. All error paths now return proper JSON responses.
PROD004,Production Logic,Critical,src/components/ImageGenerator.tsx,55,Frontend Fetch to n8n Lacks Timeout: No AbortController/timeout on fetch(VITE_N8N_WEBHOOK_URL). External API hangs cause UI freeze.,Add AbortController with timeout (e.g., 60 seconds) to fetch request. Handle AbortError gracefully with user-friendly error message.,Completed,Added AbortController with 60-second timeout. Added abortControllerRef for cleanup on component unmount. Added timeoutId to abort fetch after 60 seconds. Added AbortError handling with user-friendly message. Cleanup in finally block clears timeout and ref.
PROD005,Production Logic,High,backend/prisma/schema.prisma,46,62,Missing Database Indexes on Foreign Keys: No @@index([userId]) on Session or GeneratedImage. findMany({where: {userId}}) and deleteMany({where: {userId}}) scan entire tables. Scales poorly >10k records/user. N+1 potential if expanding queries.,Add @@index([userId]) to Session and GeneratedImage models in Prisma schema. Run migration to create indexes.,Completed,Added @@index([userId]) to Session model. Added @@index([userId]) to GeneratedImage model. Ran db:push to apply schema changes to database. Prisma Client regenerated. Database now in sync with schema.
PROD006,Production Logic,High,backend/src/routes/auth.ts:23,backend/src/routes/users.ts:5,Multiple Prisma Client Instances: New PrismaClient() per route file. Exhausts connection pool under concurrent load (Neon/Postgres limits ~20-100).,Create singleton PrismaClient instance in separate file (e.g., lib/prisma.js). Export single instance for use across all routes.,Completed,Created backend/src/lib/prisma.js with singleton PrismaClient using globalThis pattern. Updated backend/src/routes/auth.ts and backend/src/routes/users.ts to import singleton instance. Added graceful shutdown handlers in backend/src/server.ts (SIGINT/SIGTERM) to disconnect Prisma on server shutdown. Prevents connection pool exhaustion under concurrent load.
PROD007,Production Logic,High,backend/src/routes/rateLimit.ts:14,n8n/image_generate_3.json,In-Memory Rate Limiting (Non-Shared): Backend daily limit Map, n8n Code node global.rateLimitStore. Lost on restart, ineffective in PM2/cluster/Docker scale-out. No Redis.,Implement Redis-based rate limiting for distributed environments. Fallback to in-memory for single-instance deployments.,Completed,Added ioredis dependency to backend/package.json. Created backend/src/lib/redis.js with Redis client, fallback to in-memory, and graceful error handling. Updated backend/src/routes/rateLimit.ts to use Redis for shared rate limiting. Added REDIS_URL to backend/.env.example. Updated backend/README.md with Redis setup instructions (Redis Cloud, Upstash, Docker). Rate limits now shared across multiple server instances.
PROD008,Production Logic,High,backend/src/routes/auth.ts,61-94,155-164,No Transactions for Related Operations: Register user+session, login deleteMany+create no $transaction. Partial failures leave orphan records.,Wrap related operations in Prisma $transaction. Ensure atomicity: either all operations succeed or all fail together.,Completed,Wrapped register endpoint user+session creation in $transaction. Wrapped login endpoint deleteMany+session create in $transaction. Both operations now atomic - all succeed or all fail together.
PROD009,Production Logic,High,backend/src/routes/auth.ts,42-69,Race Conditions on Unique Fields: Concurrent register same email/username: findFirst then create no lock/tx. Possible duplicates despite @unique.,Use Prisma's upsert or handle unique constraint errors with retry logic. Consider database-level constraints with proper error handling.,Completed,Added explicit P2002 unique constraint error handling in register endpoint catch block. Returns 409 Conflict with error message and field info when email already exists. Prevents duplicate user records from concurrent registration attempts.
PROD010,Production Logic,Medium,backend/src/server.ts,26,CSP Blocks External Resources: Helmet imgSrc: ["'self'", "data:", "https://images.unsplash.com"]. Pollinations.ai images (blob data:) ok, but future external fails.,Add wildcard or specific domains to CSP imgSrc directive for future external image sources. Consider CSP nonce for dynamic sources.,Pending,Medium: Future external image sources will be blocked
PROD011,Production Logic,Medium,src/components/ImageGenerator.tsx,70,85,Object URL Memory Leaks: URL.createObjectURL(imageBlob) not revoked on unmount/history clear. Accumulates in long sessions.,Add useEffect cleanup with URL.revokeObjectURL() when component unmounts or image changes. Track and revoke all created object URLs.,Completed,Added objectUrlsRef Set to track all Object URLs and revoke them on component unmount. Fixed memory leak in ImageGenerator.
PROD012,Production Logic,Medium,backend/src/utils/auth.ts,20,Missing Env Var Checks: JWT secrets process.env.JWT_SECRET! no existence check. Unset -> crash. VITE_N8N_WEBHOOK_URL checked frontend only.,Add startup validation for required environment variables. Fail fast with clear error message if JWT_SECRET or other required vars are missing.,Pending,Medium: Server crashes silently on missing env vars
PROD013,Production Logic,Medium,backend/src/routes/auth.ts,103,Generic Error Responses: All catches -> 500 "Internal server error" no context. Prod debugging hard; leaks stack if not careful.,Implement error classification: return specific error codes (400, 401, 404, 409) with descriptive messages. Log full error details server-side only.,Pending,Medium: Difficult to debug production issues
PROD014,Production Logic,Medium,n8n/image_generate_3.json,119-120,No Retry/Fallback in n8n: Configures multiple APIs but calls only first. Single point failure.,Implement retry logic with fallback to alternate APIs. Configure max retries with exponential backoff between attempts.,Pending,Medium: Single API failure causes complete workflow failure
PROD015,Production Logic,Low,backend/src/server.ts,54,No Graceful Shutdown: Server no fastify.close() on SIGTERM. Abrupt DB disconnects.,Add SIGTERM/SIGINT handlers to gracefully close Fastify server and Prisma connections. Allow in-flight requests to complete.,Completed,Graceful shutdown already implemented (lines 66-81). SIGINT/SIGINT handlers present with proper cleanup.
PROD016,Production Logic,Low,src/components/ImageGenerator.tsx,46,Frontend No Input Sanitization: Params direct to query no trim/escape. n8n validates length only.,Add input sanitization: trim whitespace, escape special characters if needed. Validate on frontend before sending to n8n.,Completed,Added trim() to message parameter before sending to n8n webhook.
PROD017,Production Logic,Low,src/lib/imageCache.ts,SessionStorage Cache Persists Cross-Tabs: No IndexedDB; limited 50 but inconsistent auth/anon.,Implement IndexedDB for persistent cache across tabs. Add proper cache invalidation on auth state changes.,Pending,Low: Inconsistent cache behavior across tabs
PROD018,Production Logic,Low,n8n/image_generate_3.json,119,Basic Content Filter: Keyword list only; evadable.,Implement more robust content filtering: use AI-based moderation or comprehensive regex patterns. Add rate limiting per user for flagged content.,N/A - Out of Scope,Basic keyword filter exists in n8n workflow (line 119). Significant improvement (AI moderation) is beyond low priority scope. Current filter provides basic protection.
PROD019,Production Logic,Low,src/lib/imageCache.ts,27,Hardcoded Limits: Images take:50, cache:50 no config.,Move hardcoded limits to environment variables or configuration file. Allow runtime adjustment without code changes.,Completed,Moved hardcoded limit to named constant MAX_CACHED_IMAGES (50). Improves code maintainability and readability.
DEP001,Dependencies,Critical,backend/package.json,1,Missing 'ioredis' dependency causes backend startup failure.,Install ioredis package in backend directory.,Completed,Installed ioredis via npm install. Backend now starts successfully without missing dependency error.
TS001,TypeScript,Critical,backend/src/routes/auth.ts,56,157,Implicit 'any' type for Prisma transaction parameter tx.,Import Prisma from '@prisma/client' and type tx as Prisma.TransactionClient.,Completed,Added import { Prisma } from '@prisma/client'. Typed tx parameter in $transaction callbacks at lines 56 and 157 as Prisma.TransactionClient. Backend compiles without TypeScript errors.
